"use strict";var formatPainterStartHTML="",formatPainterEndHTML="",formatPainterEnabled=!1,formatPainterTags=[],formatPainterTDStyle="",formatPainterTDClass="",formatPainterLIStyle="",formatPainterLIClass="",formatPainterATag=!1,formatPainterAStyle="",formatPainterAClass="",formatPainterDebug=!1;function applyFormatPainter(){formatPainterEnabled=!1;var e=froalaEditor.selection.ranges(0);formatPainterDebug&&console.log("Start Range",e);var t=froalaEditor.selection.element();if(formatPainterDebug&&console.log("Element",t,t.nodeName),"BODY"!==t.nodeName&&"IMG"!==t.nodeName){for(var a=null,r=t;null!=r&&"BODY"!=r.nodeName;){if("A"==r.nodeName){a=r;break}r=r.parentNode}formatPainterDebug&&null!=a&&console.log("Clicked a link: ",a);var n=null;if(""!=formatPainterTDStyle||""!=formatPainterTDClass)for(r=t;null!=r&&"BODY"!=r.nodeName;){if("TD"==r.nodeName){n=r;break}r=r.parentNode}var o=null;if(""!=formatPainterLIStyle||""!=formatPainterLIClass)for(r=t;null!=r&&"BODY"!=r.nodeName;){if("LI"==r.nodeName){o=r;break}r=r.parentNode}for(var l=null,r=t;null!=r&&"BODY"!=r.nodeName;){if(new RegExp("h[1-6]","gi").test(r.nodeName)){l=r;break}r=r.parentNode}formatPainterDebug&&null!=l&&console.log("Cell heading selected",l);var s=!1,i=!1;if(e.startOffset==e.endOffset){var m=document.getElementsByClassName("fr-iframe")[0],f=m.contentWindow.getSelection(),c=m.contentDocument.createRange();if(new RegExp("<h[1-6]","gi").test(formatPainterStartHTML))c.selectNodeContents(t),s=!0;else{var m=e.startContainer,d=m.wholeText;formatPainterDebug&&console.log(d);for(var P=new RegExp("[ ,.!?;]","g"),u=e.startOffset;!P.test(d.substring(u,u+1))&&0<u;)u--;0<u&&u++;for(var g=e.startOffset;!P.test(d.substring(g,g+1))&&g<d.length;)g++;c.setStart(m,u),c.setEnd(m,g),i=!0}f.removeAllRanges(),f.addRange(c),e=froalaEditor.selection.ranges(0)}formatPainterDebug&&console.log("Is selected element",s),formatPainterDebug&&console.log("Is selected word",i);c=froalaEditor.selection.get();if(formatPainterDebug&&console.log("Selection:",c),e.startOffset!=e.endOffset){c=froalaEditor.selection.text();formatPainterDebug&&console.log("Selected text:",c),froalaEditor.undo.saveStep();var T,p,L=e.startContainer;if(i)l?(formatPainterDebug&&console.log("selected heading:",L.parentNode),L.parentNode.outerHTML=formatPainterStartHTML+L.parentNode.outerText+formatPainterEndHTML):a?(a.className="",a.style.cssText="",T=cleanupFormatPainterStartHTML(formatPainterStartHTML),p=cleanupFormatPainterEndHTML(formatPainterEndHTML),N=T+a.innerText+p,formatPainterDebug&&console.log("Link new html:",N),a.innerHTML=N):(T=cleanupFormatPainterStartHTML(formatPainterStartHTML,!0),p=cleanupFormatPainterEndHTML(formatPainterEndHTML,!0),formatPainterDebug&&console.log("Inner HTML:",L.parentNode.innerHTML),formatPainterDebug&&console.log("Range start offset",e.startOffset),formatPainterDebug&&console.log("Range end offset",e.endOffset),p=T+c+p,formatPainterDebug&&console.log("Replacement HTML:",p),formatPainterDebug&&console.dir(L.parentNode),e.extractContents(),froalaEditor.html.insert(p));else if(s){var N=formatPainterStartHTML+c+formatPainterEndHTML;if(formatPainterDebug&&console.log("Applying style to whole element",L,N),null!=l)l.outerHTML=N;else if(null!=a){a.className="",a.style.cssText="",N=formatPainterStartHTML+a.outerHTML+formatPainterEndHTML,formatPainterDebug&&console.log("Applying style to link",N),formatPainterDebug&&console.dir(a),a.href="javascript:function() { return false; }";const M=["p","span","div"];null!=a.parentNode&&M.includes(a.parentNode.nodeName.toLowerCase())?a.parentNode.outerHTML=N:a.outerHTML=N}else{const H=["h1","h2","h3","h4","h5","h6","div","table","tr","td","li","img","p"];for(;null!=L.parentNode&&"BODY"!=L.parentNode&&!H.includes(L.nodeName.toLowerCase());)L=L.parentNode;formatPainterDebug&&console.log("Applying style to whole parent element",L),"LI"==L.nodeName?L.innerHTML=N:L.outerHTML=N}}else formatPainterDebug&&console.log("apply formating to users custom selection",e),null!=a?formatPainterStartHTML.includes("<h")?showNotificationWarning(lajax.t("Can not apply heading style to a part of a link.")):c==a.innerText&&(formatPainterDebug&&console.log("Selected whole link:",a),a.className="",a.style.cssText="",N=formatPainterStartHTML+a.outerHTML+formatPainterEndHTML,a.href="javascript:function() { return false; }",a.parentNode.outerHTML=N):(N=t.parentNode.outerHTML,formatPainterDebug&&console.log("Parent HTML:",N),("BODY"!=t.parentNode.nodeName||"BODY"==t.parentNode.nodeName&&0<e.startOffset)&&(formatPainterStartHTML=cleanupFormatPainterStartHTML(formatPainterStartHTML),formatPainterEndHTML=cleanupFormatPainterEndHTML(formatPainterEndHTML)),c.split(/(?:\r?\n)+/).forEach(function(e){froalaEditor.html.insert(formatPainterStartHTML+e+formatPainterEndHTML)}));null!=a&&formatPainterATag&&(a.style.cssText=formatPainterAStyle,a.className=formatPainterAClass),null!=n&&(""!=formatPainterTDStyle&&(n.style.cssText=formatPainterTDStyle),""!=formatPainterTDClass&&(n.className=formatPainterTDClass)),null!=o&&(""!=formatPainterLIStyle&&(o.style.cssText=formatPainterLIStyle),""!=formatPainterLIClass&&(o.className=formatPainterLIClass)),froalaEditor.undo.saveStep(),setTimeout(function(){contentChange()},50)}}else showNotificationWarning(lajax.t("Can not apply style to this element, please click on some text."))}function cleanupFormatPainterStartHTML(e,t=!1){e=e.replaceAll("<p","<span").replaceAll("<div","<span");return e=t?e.replace(/<li[^<>]*>/gi,""):e}function cleanupFormatPainterEndHTML(e,t=!1){e=e.replaceAll("</p>","</span>").replaceAll("</div>","</span>");return e=t?e.replace("</li>",""):e}function runFormatPainter(){var e=froalaEditor.selection.element();if(formatPainterDebug&&console.log("Element FP:",e),null!=e){formatPainterStartHTML=formatPainterEndHTML="",formatPainterTDStyle=formatPainterTDClass="",formatPainterLIStyle=formatPainterLIClass="",formatPainterATag=!(formatPainterTags=[]),formatPainterAStyle=formatPainterAClass="";var t,a=e;const r=["strong","b","em","i","u","pre","cite","code","q","s","mark","kbd","sub","sup","small","h1","h2","h3","h4","h5","h6"],n=["table","td","tr","th","li","img"];for(;null!=a&&"BODY"!=a.nodeName;){if(formatPainterDebug&&console.log(a.nodeName,a.style,a.className),"TD"==a.nodeName?(formatPainterTDStyle=a.style.cssText,formatPainterTDClass=a.className):"LI"==a.nodeName?(formatPainterLIStyle=a.style.cssText,formatPainterLIClass=a.className):"A"==a.nodeName?(formatPainterAStyle=a.style.cssText,formatPainterAClass=a.className,formatPainterATag=!0):""==a.style.cssText&&""==a.className&&!r.includes(a.nodeName.toLowerCase())||(formatPainterTags.push(a.cloneNode()),t="",t="<"+a.nodeName.toLowerCase(),""!=a.className&&(t+=' class="'+a.className+'"'),""!=a.style.cssText&&(t+=' style="'+a.style.cssText.replaceAll('"',"'")+'"'),formatPainterStartHTML=(t+=">")+formatPainterStartHTML,formatPainterEndHTML+="</"+a.nodeName.toLowerCase()+">"),n.includes(a.nodeName.toLowerCase()))break;a=a.parentNode}formatPainterDebug&&console.log("Format painter start/end HTML: ",formatPainterStartHTML,formatPainterEndHTML),formatPainterEnabled=!0,trackEvent("Run format painter","click")}else showNotificationWarning(lajax.t("Please click an element in the Visual Editor and then click Format Painter icon again."))}